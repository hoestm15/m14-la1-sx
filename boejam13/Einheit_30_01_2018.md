# Protokoll
  Böcksteiner Jakob  
  4AHME, Gruppe 1  
  30.01.18  
  Anwesend: Berger, Böcksteiner, Ehman, Kobor, Knappitsch  
  Abwesend: Bullner, Enzi
  
  ## Projekt Temperaturmessung
  Es ist ein Programm zu vervollständigen um die Temperaturmessung möglich zu machen, die Vorlage war soweit vervollständigt das wir keine GUI mehr programmieren mussten und uns deshalb ein großer Zeitaufwand erspart wurde.
  
  ### Programmierung
  #### GUI
  ![](boejam13/GUI.svg)
  
  #### updateSwingControlls
  Als erstes haben wir alle Buttons Deaktiviert um den Gesamten vorschritt des Programms leichter erkennen zu können. 
  Refresh Button ist von anfang an aktiviert um es zu ermöglichen falls man erst ein USB-Gerät anschließt dsa dieses auch erkannt werden kann. Wenn bereits ein Gerät verbunden ist, wird der Refresh-Button deaktiviert und Disconnect aktiviert. Ist aber kein Gerät verbunden so bekommt man die möglichkeit einen Port auszuwählen und sich mit diesem zu Verbinden.
  
  
  ```c
  private void updateSwingControls (){
    jbutRefresh.setEnabled(true);
    jbutConnect.setEnabled(false);
    jbutContinousMeasurement.setEnabled(false);
    jbutDisconnect.setEnabled(false);
    jcbSerialDevice.setEnabled(false);
    jbutSingleMeasurement.setEnabled(false);
    jlaTemperatur.setText("--");
    jbutStopMeasurement.setEnabled(false);
    
    if (serialPort != null && serialPort.isOpened()){
      jbutRefresh.setEnabled(false);
      jbutDisconnect.setEnabled(true);
    }else if(jcbSerialDevice.getModel().getSize() > 0) {
      jcbSerialDevice.setEnabled(true);
      jbutConnect.setEnabled(true);
    }
  }
  ```
  
  #### showThrowable
  Diese Funktion verarbeitet geworfene Exceptions und gibt entwerder eine Nachricht einer geworfenen Exception aus, eine Fehlermeldung ohne genauere Information oder eine *ERROR_MESSAGE*.

```c
private void showThrowable (Throwable th){
    th.printStackTrace(System.err);
    
    String msg = th.getMessage();
    if(msg == null || msg.isEmpty()){
      msg = th.getClass().getSimpleName();
    }
    JOptionPane.showMessageDialog(this, 
                                  msg, 
                                  "Fehler Aufgetreten",
                                  JOptionPane.ERROR_MESSAGE);
  }
  ```
  
  #### refreshPorts
  Diese Funktion Aktualisiert die Angeschlossenen Schnittstellen. Es wird ein String erstellt um die Namen der Ports zu speichern und in der GUI anzeigen zu lassen. Es wird versucht der Port mit dem Inhalt *USB* direkt auszuwählen, da dies der Port mit dem Angeschlossenem SURE-Board ist. Ist der Bevorzuget Port nicht verfügbar wird ein anderer an erster Stelle angezeigt.
  ```c
  private void refreshPorts () {
    final String [] ports = jssc.SerialPortList.getPortNames();
    String preferedPort = null;
    for (String p : ports){
      if(p.contains("USB")){
        preferedPort = p;
        break;
      }
    }
          
   jcbSerialDevice.setModel(new DefaultComboBoxModel<String>(ports));
   if(preferedPort != null){
     jcbSerialDevice.setSelectedItem(preferedPort);
   }
   updateSwingControls();
  }
 ```
  #### connectPort
  Es wird der ausgewählte Port geöffnet um darauf Zugriff zu erhalten, die Funktion bekommt den String des gewählten Ports Übergeben. Falls der Port nicht geöffnet werden kann wird eine Exception geworfen und der Port wieder auf *null* gesetzt. In beiden fällen wird wieder die Funktion *updateSwingControls* aufgerufen.
  ```c
  private void connectPort ( String port){
    serialPort = new jssc.SerialPort(port);
    
    try
    {
      serialPort.openPort();
    }
    catch (Throwable ex)
    {
      showThrowable(new Exception("Serielle Schnittstelle kann nicht geöffnet werden", ex));
      serialPort = null;
    }
    finally{
      updateSwingControls();
    }
  }
  ```
  
  #### disconnectPorts
  Es wird kontroliert ob es den Port wirklich gibt, auch wenn es vorher schon mehrmals überprüft wurde. Falls es diesn nicht gibt wird eine Exception geworfen und *Interner Fehler* ausgegeben. Wenn der Port verfügbar ist wird dieser geschlossen, ist das nicht möglich wird eine Exception geworfen und eine Nachricht ausgegeben. Hat alles funktioniert wird *serialPort* auf *null* gesetzt und die Funktion *updateSwingControls* aufgerufen.
  ```c
  private void disconnectPort (){
    if(serialPort == null || !serialPort.isOpened()){
      showThrowable(new Exception("Interner Fehler"));
      return;
    }
    try
    {
      serialPort.closePort();
    }
    catch (Throwable ex)
    {
      showThrowable(new Exception("serielle Schnittstelle kann nicht geschlossen werden"));
    } finally{
      serialPort = null;
      updateSwingControls();
    }
  }
  ```
  
  #### actionButtons
  ##### Connect
  ```c
  private void jbutConnectActionPerformed(java.awt.event.ActionEvent evt) 
  {                                                
    connectPort((String)jcbSerialDevice.getSelectedItem());
  
  }   
  ```
  ##### Disconnect
  ```c
  private void jbutDisconnectActionPerformed(java.awt.event.ActionEvent evt) 
  {                                                   
    disconnectPort();
  }                                              
  ```

  ##### Refresh
  ```c
  private void jbutRefreshActionPerformed(java.awt.event.ActionEvent evt)   
  {                                                
      refreshPorts();
  }  
  ```
    
    

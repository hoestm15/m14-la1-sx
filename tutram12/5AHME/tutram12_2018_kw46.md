# *3. Laborprotokoll*

  Name: Tuttner Raphael   
  Klasse: 5AHME   
  Datum: 12.11.2018   
  Anwesend: Strauß Lukas, Tuttner Raphael, Waltl Kilian, Wieser Markus, Zitz Karlheinz    
  Abwesend: Strutz Sebastian, Uhl Christian
  
  ## Rest-Server
  
Für den Rest-Server wurden die Klassen **student** und **database** erstellt. Die Klasse **student** nimmt hier die Rolle einer Datenerhaltungsklasse ein, die Klasse **database** agiert als Datenbank. Die Klasse **server** wurde erweitert.

  ## Datenbank
  
Eine Datenbank ist ein **elektronisches Verwaltungssystem**, welches Daten sammeln, halten und verwalten können soll. Eine Datenbank soll mit großen Datenmengen **effizient**, **dauerhaft** und **ohne Wiedersprüche** umgehen können. Datenbanken können in **schematische (klare Struktur)** und nicht **schematische (nicht klare Struktur)** Datenbanken eingeteilt werden. Eine sehr weit verbreitete **Programmiersprache** für Datenbanken ist **SQL**.
  
  ## Singleton (Entwurfsmuster)
  
Ein **Singleton** ist ein Entwurfsmuster aus der Softwareentwicklung, welches sicher stellt, dass es von einer Klasse auch nur ein Objekt gibt. Im Normalfall bietet es **globalen Zugriff** auf das Objekt.  
In Unserem Beispiel verwenden wir eine **Datenbank**, wodurch wir auch dieses Entwurfsmuster nutzen. Eine Datenbank **existiert nur einmal** und es werden auch nur die Werte dieser verändert.
  
  ## Klasse database.ts
  
Unsere Datenbank wurde als Singleton realisiert. Hierfür setzten wir unsere Konstruktor private und riefen getInstance() zu Beginn auf, wodurch wir ein Objekt erzeugten. Ist schon eine Instanz vorhanden, wird dieser Vorgang übersprungen. Weiters fügten wir noch die Funktionen add() und get() hinzu.
  
  ```typescript
import { Student } from './student';

export class Database
{
    private static instance: Database;

    public static getInstance (): Database
    {
        if (Database.instance == null)
        {
            Database.instance = new Database();
        }
        return Database.instance;
    }

    private students: { [ id: string ]: Student } = {};

    private constructor ()
    {
         this.add(new Student('tutram12', 'Tuttner', 'Raphael' ));
         this.add(new Student('zitkam13', 'Zitz', 'Karlheinz' ));
    }

    public add (s: Student)
    {
        if (this.students[s.getHtlid()])
        {
            throw new Error('student already existing');
        }
        this.students[s.getHtlid()] = s;
    }

    public get (htlid: string): Student
    {
        return this.students[htlid];
    }
}

  ```
  
  ## Klasse student.ts
  
Bei der Datenhaltungsklasse student sind alle Datenelemente für einen Schüler private. Aufgrund dessen werden hier auch Getter Methoden verwendet. Um die Klasse exportieren zu können, wird zu Beginn export verwendet. Wenn man sie nun in einer anderen Klasse importiert, kann man auf die verschiedenen Getter Methoden zugreifen (wie in der Klasse database.ts).
  
  
  ```typescript
   export class Student {

    private htlid: string;
    private surname: string;
    private firstname: string;

    constructor (htlid: string, surname: string, firstname: string)
    {
        this.htlid = htlid;
        this.surname = surname;
        this.firstname = firstname;
    }

    public getHtlid (): string
    {
        return this.htlid;
    }

    public getSurname (): string
    {
        return this.surname;
    }

    public getFirstname (): string
    {
        return this.firstname;
    }
}
  ```
  
  ## Klasse server.ts
  
In dieser Klasse erweiterten wir die Handler-Methode durch das Verbinden mit unserer Datenbank. Der Body-Parser fragt mit req.query.htlid die HTL-ID ab, welche dann in einer Variable gespeichert wird. Existert ein Schüler mit solch einer ID, wird dieser ausgegeben. Ansonsten wird eine Fehlermeldung ausgegeben. Am Ende begannen wir noch mit der HandlePutStudent, welche in späterer Folge einen Schüler anlegen soll.
  
  
```typescript

import * as express from 'express';
import * as bodyParser from 'body-parser';
import { Database } from './database';

export class  Server
{
   private _server: express.Express;
    constructor ( port: number) {
        this._server = express(); 
        this._server.use(bodyParser.urlencoded({extended: false}));
        this._server.use(bodyParser.json);
        this._server.get('/student', (req, resp, next) => this.handleGetStudent(req, resp, next));
        this._server.put('/student', (req, resp, next) => this.handlePutStudent(req, resp, next));
        this._server.listen(port); 
        console.log('HTTP server gestartet auf Port ' + port);
    }
    
    private handleGetStudent (req: express.Request, resp: express.Response, next: express.NextFunction)
    {
        console.log('Abfrage');
        console.log(req.query.htlid);

        const id = req.query.htlid;
        const s = Database.getInstance().get(id);
        if (s)
        {
            resp.json(s);
        }
        switch (req.query.htlid)
        {
            case 'tutram12':
            resp.json({surname: 'Tuttner', firstname: 'Raphael'}); break;
            case 'zitkam13':
            resp.json({surname: 'Zitz', firstname: 'Karlheinz'}); break;
            case 'strlum14':
            resp.json({surname: 'Strauß', firstname: 'Lukas'}); break;

            default:
                resp.status(404);
                resp.end();
        }
        resp.send('Antwort' + req.query.htlid);
    }
    
    private handlePutStudent (req: express.Request, resp: express.Response, next: express.NextFunction)
    {
        console.log(req.query.htlid);
        console.log(req.body);
        resp.send('Test');
        resp.end();
    }
}
```

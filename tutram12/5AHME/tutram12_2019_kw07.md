# Laborprotokoll  
Name: Tuttner Raphael  
Gruppe: 4  
Klasse: 5AHME  
Datum: Mo, 11.02.2019  
Ort: Automatisierungslabor, HTBLA Kaindorf  

Anwesend: Strauß, Strutz, Tuttner, Uhl, Wieser, Waltl, Zitz  
Abwesend: -

# Thema:Erweiterung Rest-Server  

## Wiederholung der letzten Einheiten  
Da die letzte Einheit in diesem Labor schon sehr weit zurück lag, wiederholten wir kurz alle besprochene Themen.  
Zudem wiederholten wir auch wie weit wir bisher bei unserem Rest-Server waren, für was die verschiedenen Klasse waren und was noch zu tun war.  
  
### Rest-Server  
Der Name **REST**-Server steht für **RE**presentational **S**tate **T**ransfer Server. Ein ReST-Server wird meist für die Maschine-zu-Maschine-Kommunikation in Websevices verwendet. Das **HTTP-Protokoll** wird in diesem Fall als Sprache zwischen Server und Client verwendet. Rest Server werden häufig zur Abfrage von Zuständen (z.B. an einem entferntem System) eingesetzt.  
  
#### HTTP 
**HTTP** (**H**ypter**T**ext **T**ransfer **P**rotocol) ist ein Protokoll zur Übertragung von Daten.  
Das Protkoll ist zustandslos. Das bedeutet das Informationen aus früheren Anforderungen verloren gehen. Deshalb ist ein mitführen von Sitzungsdaten erforderlich.  
Um Daten verschlüsselt zu Übertragen gibt es das **HTTPS-Protokoll**. Weiteres erfolgt die Übertragung textuell. 
  
Wichtige Befehle:  
* **GET**:     Daten vom Server abrufen    
* **POST**:    Daten zum Server schicken   
* **PUT**:     Daten auf den Server laden  
* **DELETE**:  Datem vom Server löschen    

### Programmiersprachen Server/Client seitig  
**Server:**  
Auf der Serverseite kann mit mit vielen verschiedenen Programmiersprachen programmiert werden (z.B. PHP, Java, Perl, JacaScript - benötigt eine Virtuelle Maschine - Node.js)  

**Client:**  
Auf der Clientseite wird hauptsächlich **JavaScript** verwendet. Javascript war unteranderem die erste Programmiersprache, die in Web-Browsern zum Einsatz kam. Eine Subsprache von Javascript ist z.B. **Typescript**, mit dem unser Server realisiert wird.  
  
JavaScript wird gerne auf Server- als auch auf Clientseite verwendet weil es die Programmierung erleichtert und man nicht zwei Programmiersprachen lernen muss.
  
### Datenerhaltung   
Für die Datenerhaltung in **Java** stehen die **Collections** zur Verfügung.  
Beispiele für Collections:  
* ArrayList     -> Ist ein Feld, welches sich immer verdoppelt, falls es  zu klein ist
* Linked List   -> Hier werden die Datensätze hintereinander gespeichert, falls ein Wert benötigt wird, muss alles durchgeschaut      werden
* HashMap       -> Hier werden keyvalue Paare erzeugt und vergeben
* HashSet       -> Änlich wie LinkedList; der Unterschied ist, dass ein Objekt nur einmal vorkommen kann  

**In Javascript:**  
* für ArrayList -> Die Listen können durch Felder ersetzt werden        -> Array (Feld)
* für HashMap   -> Maps können durch einfache Objekte realisiert werden -> Object  

### Klassen student.ts, database.ts, server.ts
In der Klasse **server.ts** wird der Server realisiert. Weiters haben wir die zwei Methoden **handlePutStudnet** und **handleGetStudnet** ausprogrammiert.  
Die Klasse **student.ts** ist eien Datenerhaltungsklasse für Schüler. Wichtig ist das in der Klasse **export** eingetragen ist, da wir sie in eine andere Klasse importieren müssen.  
Die Klasse **database.ts** stellt unsere Datenbank dar, sie wird nach dem Entwurfsmuster **Singelton** programmiert. In dieser Klasse haben wir auch die Methoden **GET** und **ADD** ausprogrammiert.  
  
## Erweiterung des Programms  
Das Ziel der Einheit war es, den aktuell porgrammierten Rest-Server zu erweitern. Das wurde durch das hinzugefügt, bzw. fertigstellt von 3 weitere Methoden für den Server bewerkstelligt.  
  
### Klasse student.ts  
In dieser Klasse wurde ein **Interface** hinzugefügt.  

``` typescript
export interface IStudent
{
    htlid: string;
    surname: string;
    firstname: string;
}
```
### Klasse database.ts  
Hier wurden die Methoden **remove** und **set** ausprogrammiert.  
Die Methode **remove** hat die Aufgabe einen Schüler zu löschen. 
Mit der Methode **set** soll man von einem Schüler, etwas verändern sollen.  
``` typescript
public remove (htlid: string)
    {
        delete this.students[htlid];
    }
    
public set (s: Student): Student
    {
        const rv = this.get(s.getHtlid());
        this.students[s.getHtlid()] = s;
        // this.students.tutram12 = s;
        return rv;
    }

```  

### Klasse server.ts  
In die Server-Klasse musst das Interface **importiert** werden. Danach sollten die Methoden **handlePutStunent**, **handleDeleteStudent** und **handlePostStudent** fertig programmiert werden.  
``` typescript
private handlePutStudent (req: express.Request, resp: express.Response, next: express.NextFunction)
{
        console.log('PUT', req. body);
        const s = <IStudent>req.body;
        try
        {
            const stud = new Student(s.htlid, s.surname, s.firstname);
            if (Database.getInstance().get(stud.getHtlid()))
            {
                resp.status(400).send('htlid already exists');
                resp.end();
                return;
            }
            Database.getInstance().add(stud);
            resp.status(200).end();
        }
        catch (err)
        {
            console.log(err);
            resp.status(400).send('invalid JSON data');
            resp.end();
        }
    }

    private handlePostStudent (req: express.Request, resp: express.Response, next: express.NextFunction)
    {
        console.log('POST', req.body);
        const s = <IStudent>req.body;
        try
        {
            const stud = new Student(s.htlid, s.surname, s.firstname);
            if (!Database.getInstance().get(stud.getHtlid()))
            {
                resp.status(400).send('htlid does not exists');
                resp.end();
                return;
            }
            Database.getInstance().set(stud);
            resp.status(200).end();
        }
        catch (err)
        {
            console.log(err);
            resp.status(400).send('invalid JSON data');
            resp.end();
        }
    }

    private handleDeleteStudent (req: express.Request, resp: express.Response, next: express.NextFunction)
    {
        console.log('DELETE', req.query.htlid);
        try
        {
            if (!Database.getInstance().get(req.query.htlid))
            {
                resp.status(400).send('htlid does not exists');
                resp.end();
                return;
            }
            Database.getInstance().remove(req.query.htlid);
            resp.status(200).end();
        }
        catch (err)
        {
            console.log(err);
            resp.status(400).send('invalid JSON data');
            resp.end();
        }
    }
```

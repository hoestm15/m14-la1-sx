# 7.Einheit: 08.05.2017

Gegenstand: LA1  
Name: Gert Enzi  
KN: 5  
Klasse: 4AHME  
Gruppe: 1  

# JNI (Java Native Interface)
JNI wird bezeichnet als standardisierte Anwendungsprogrammierschnittstelle. Sie kann verwendet werden, wenn es bei einer Anwendung
nicht möglich ist, nur Java als Programmiersprache zu verwenden. In unserem Fall hilft es uns dabei, unser Java Projekt mit dem 
Microcontroller (C-Programm) zu verbinden. Dies wird durch die Programmbibliothek ermöglicht, die auf beiden Plattformen vorhanden sein
muss.


# Fortsetzung Programm

In dieser Einheit setzten wir unser Programm fort. Dabei haben wir sowohl vorhandene Klassen erweitert als auch neue erstellt.

## SwingWorker

### Multithreading
Um ein Programm effiziend laufen zu lassen empfiehlt es sich, die Aufgaben des Programmes auf mehrere Programmfäden aufzuteilen. Somit 
werden die Aufgaben auf die Kerne des Prozessors aufgeteilt und man kann mehrere Aufgaben gleichzeitig erledigen. Um Multithreading 
verwenden zu können benutzen wir den SwingWorker, der folgende Methoden besitzt:

| Methode | Beschreibung |
| ------- | ------------ |
| `execute()` | Die `doInBackground` Methode wird aufgerufen und der Worker wird gestartet |
| `doInBackground()` | Sämtliche Befehle, die im Nebenthread ablaufen sollen, werden hier realisiert |
| `publish()` | Hiermit kann man Zwischenergebnisse an den [EDT-Thread](https://docs.oracle.com/javase/tutorial/uiswing/concurrency/dispatch.html) senden |
| `get()` | Dadurch erhält man den Rückgabewert der `doInBackground` Methode |
| `process()` | Was soll getan werden während der Worker arbeitet |
| `done()` | Was soll getan werden nachdem der Worker fertig ist |

In unserem Fall hat die `doInBackground()` Methode folgendermaßen ausgesehen:

```java
@Override
    protected Double doInBackground() throws Exception 
    {
        
        publish("Einzelmessung gestartet");
       
        byte [] frame = {0x02, 0x04, 0x00, 0x30, 0x00, 0x01, 0x31, (0xf6-256)};
        
        if (serialPort.writeBytes(frame) == false) {
            throw new Exception("cannot send frame");
        }
                
        TimeUnit.SECONDS.sleep(2);
        byte [] response = serialPort.readBytes();
        System.out.println(response.length);
        byte hb = response[3];
        byte lb = response[4];
        int t = (hb < 0 ? hb+256 : hb) * 256 + (lb < 0 ? lb+256 : lb);
        
        return t/256.0;
    }
```  
Und die `done()` und `process()` Methode:  
```java
@Override
protected void done() 
{
    try 
    {
        double temp = get();
        jlaTemperatur.setText(String.format("%.1f °C", temp));
        jtfStatus.setText(null);
    } 
    catch (Exception e) 
    {
        showThrowable(new Exception("Einzemessung gescheitert", e));
    } 
    finally 
    {
        activeWorker = null;
        updateSwingControls();
    }
}
```
```java
@Override
protected void process(List<String> chunks) 
{
    jtfStatus.setText(chunks.get(chunks.size()-1));
}
```

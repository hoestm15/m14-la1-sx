# Protokoll
## Thema: Entwickeln eines eigenen Compilers

Name: Platzer Andreas <br>
Datum: 06.02.2018 <br>
Gruppe: 2 <br>
Anwesend: Platzer Andreas, Muri Lorenz, Nebel Florian, Mandl Gerhard, Michael Mörth, Moritz Martinak, Mario Nabernik, Marcel Köhler <br>
Abwesend: Es waren alle anwesend. <br>
Abgabe Datum: 13.02.2018 <br>

## Kompilieren

Um ein Programm auf einen Rechner oder Microcontrollers laufen lassen zu können muss es zuerst kompiliert werden. Genauer gesagt ging es in unserer Übung darum, ein einfaches c Programm für den Atmega328p automatisch zu kompilieren.
 

### Makefiles 
Um verfahren wie zum Beispiel eine Datei zu übersetzen zu erleichtern verwendet man sogenannte Makefiles. Diese meist im Terminal geschriebenen Programme arbeiten Befehle in einem Programm ab die sonst in den Terminal eingegeben werden müssten. Dies spart zeit und bringt ein dynamisches Arbeiten von z.B. Compilern Vorgängen.

#### Aufbau:
Zeil Datei: Anfangsdatei
{Tabulator} Befehl der ausgeführt werden soll
```
Ziel Datei1: Anfangsdatei1 
[Tabulator] Befehl 1  
[Tabulator] Befehl 2 
 

Ziel Datei1: Anfangsdatei2
[Tabulator] Befehl 1  
[Tabulator] Befehl 2  
```

#### Abarbeitung:
Mit dem Befehl make wird das Programm ausgeführt. Wichtig zu wissen ist, dass das Tool nur Dateien aktualisiert, wenn der Zeitstempel passt. Möchte man dennoch Dateien neu ausführen, kann man diese entweder im Zeil Ordner löschen oder den Zeitstempel verändern. Dies kann man mit dem Befehl touch durchführen.


## 1.Aufgabe 
Unsere erste Aufgabe war es eine einfaches C-Programm für den Arduino zu kompilieren. Dies sollte mit einem make-Programm umgesetzt werden.
### Schritt 1 Erstellen eines Programms
Hierzu wurde zuerst das Programm geschrieben und als main.c abgespeichert.

#### Quelltext

```c
#include <avr/io.h>
#include <util/delay.h>

int main()
{
        DDRB = (1<<PB5);
        while(1)
        {
                PORTB=(1<<PB5);
                _delay_ms(600);
                PORTB = 0;
                _delay_ms(600);
        }
        return 0;
}
```
### Schritt 2 Makefile Programm
Dann wurde das makefile Schritt für Schritt aufgebaut.

#### Quelltext

```
main.hex: main.elf
        avr-objcopy -O ihex main.elf main.hex

main.elf: main.o
        avr-gcc -o main.elf main.o

main.o: main.c
        avr-gcc -mmcu="atmega328p" -Os -c -DF_CPU=16000000L main.c

clean:
        -rm main.o
        -rm main.elf
        -rm main.hex
```  

#### Beteutungen:

Befehl | Beschreibung
------ | ---------
avr-gcc -mmcu="atmega328p" -Os -c -DF_CPU=16000000L main.c | -mmcu beschreibt welches Gerät Controller verwentet wird, -c sorgt dafür das die Datei kompiliert wird, -DF_CPU=16000000L steht für die Taktfrequenz
avr-gcc -o main.elf main.o | -o ist für das linken zustäntig, main.elf umwandlung von main.o in main.elf 
avr-objcopy -O ihex main.elf main.hex | ihex ist für das Format zustäntig, Hier wird die main.elf weiter zu main.hex verarbeitet



## 2.Aufgabe

In der zweiten Aufgabe mussten wir mit dem Makefile-Tool das C-Programm übersetzen und zusätzlich einen bootloader mit installieren. Hierzu suchten wir ein einem Programm nach der Hex-Datei die wir anschließend in das Zeil Verzeichnis kopierten. 

### Quelltext
```
main.hex: main.elf
        avr-objcopy -O ihex main.elf main.hex

main.elf: main.o
        avr-gcc -o main.elf main.o

main.o: main.c
        avr-gcc -mmcu="atmega328p" -Os -c -DF_CPU=16000000L main.c

flash: main.hex
        avrdude -c usbasp -p atmega328p -e -U flash:w:bootloader.hex:i
        touch flash
```
#### Beteutungen:

Befehl | Beschreibung
------ | ---------
avrdude -c usbasp -p atmega328p -e -U flash:w:bootloader.hex:i | Bootloader wird überspielt
touch flash | Zeitstempel wird aktualisiert

#### Programm und Bootloader gleichzeitig überspielen 

Um zwei Dateien gleichzeitig überspielen zu können mussten wir die zwei .hex Dateien zusammenfügen dies geschah mit dem Befehl cat. Bevor die Datei aber geflasht werden konnten mussten wir noch die letzte Zeile des ersten Programmes löschen, da ansonsten das Programm an dieser Stelle beendet worden wäre.




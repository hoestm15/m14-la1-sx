# Protokoll

## Thema: Programmieren eines einfachen Rest Server
Name: Platzer Andreas <br>
Datum: 14.01.2019 <br>
Anwesend: Mandl Gerhard, Martinak Moritz, Mörth Michael, Muri Lorenz, Nabernik Mario, Nebel Florian, Platzer Andreas <br>
Abwesend: -<br>
Abgabe Datum: 21.01.2019 <br>

### Wiederholung und Aufbau
In der dritten Einheit wurden die Themen der letzten Laborstunde kurz wiederholt. Anschließend war es die Aufgabe, ein Programm zu entwickeln, dass eine Webseite auf einen bestimmten Port am eigenen PC freigibt. Die Webseite sollte in einer Struktur aufgebaut werden und ein paar Einträge enthalten (zum Beispiel die Namen einer Schulklasse). <br>
  *[Letztes Protokoll](https://github.com/HTLMechatronics/m14-la1-sx/edit/plaanm14/plaanm14/README_19_01_07.md)*

## Hauptprogramm
```typescript
import {Server} from './server';        //Der Server wird eingebunden

class Main {                            //Hauptklasse

    public static main () {             //Hauptmethode
        const server = new Server();    // Server wird erzeugt
        server.start(4711);             // Server startet am Port 4711
    }
}

Main.main();                            //Ausführung der Klasse
```

### Funktionsweise
Die Aufgabe der Main.ts (Hauptklasse) ist es, den Server zu starten. Hierbei wird zuerst die Server Klasse eingebunden. Die Methode public static mein() startet den Server am Port 4711. Zuletzt wird noch Main.main() hinzugefügt sodass die Klasse auch ausgeführt wird. 

## Server
```typescript
import * as express from 'express';
import { json } from 'body-parser';
import * as bodyParser from 'body-parser';


export class Server {
    private _server: express.Express;

    constructor() {
        this._server = express();
        this._server.use(bodyParser.urlencoded());
        this._server.get('/version', (req, res, next) => {
            res.send('Version 1.0');
        });
        this._server.get('/student', (req, res, next) => this.handleGetStudent(req, res, next));
    }

    public start(port: number) {
        this._server.listen(port);
        console.log('Server auf Port ' + port + ' gestartet!');
    }

    public stop() {
        console.log('TO DO');
    }

    private handleGetStudent(req: express.Request, res: express.Response, next: express.NextFunction) {
        console.log('query --> ' + req.query);
        console.log('GET..');
        res.json({surname: 'Platzer', firstname: 'Andreas'});
    }
}
```

Die Klasse `Server.ts` ist für das Menagen des Servers und das ausgeben der Daten zuständig. Die Methode `start()` und `stop()` sind wie der Name schon deutet für das Starten und Stoppen des Servers zuständig. Im `constructor()` wird der Server Initialisiert und die Ausgabe der Daten programmiert. Im Falle des Aufrufens der Versionsnummer `(„/version“)` würde die Webseite anschließend „Version 1.0“ ausgeben. Oder die entsprechenden Schüler bei `„/student“`. Die Methode `handleGetStudent()` managt das Nachfrage der Schüler.

### Express
Um die Website auch „Website fähig“ zumachen benötigt die Klasse eine zusätzliches Modul, nämlich das sogenannte Express. Dieses wird mit `npm install express` und `npm install --save-dev @types/ `express installiert.<br>
Weitere Informationen:
  *[Express](https://www.npmjs.com/package/express)*


### Body-Parser
Der Body-Parser ist für die Informationen der Variable zuständig. 
Das Modul kann mit `npm install body-parser` und `npm install --save-dev @types/body-parser` installiert werden.<br>
Weitere Informationen:
  *[Body-Parser](https://www.npmjs.com/package/body-parser)*
  
## db-user
```typescript
import { Student } from './student';

export class DbUser {

    public static  getInstance (): DbUser {
        if (DbUser.getInstance === null) {
            DbUser.instance = new DbUser();
        }
        return DbUser.instance;
    }

    private static instance: DbUser;

    // *********************************************************

    private _students: {
        [ id: string]: Student
    };

    private constructor () {
        this._students = {};

        let s = new Student('plaanm14', 'Platzer', 'Andreas');
        this._students[s.id] = s;

        s = new Student('murlom14', 'Muri', 'Lorenz');
        this._students[s.id] = s;

        s = new Student('nabmam14', 'Nabernik', 'Mario');
        this._students[s.id] = s;
    }

    public get(id: string): Student {
        return this._students[id];
    }
}
```
`Dbuser` ist für die Daten zuständig. Hier werden die Einträge gespeichert. Hierzu gibt es einige Arten zur Formatierung und Programmierung. Eine Art wäre die Singleton Methode, hierbei wird ein nach dem ersten Aufruf ein Objekt. Nach dem Anlegen wird nur mehr auf die Variablen zugegriffen und geändert. Wichtig dabei ist es das der Konstruktor `private` ist und eine Methode `getInstance()` hat. In unserem Fall werden 3 Schüler im Programm angelegt. 



## Student
```typescript
export class Student {

    public surname: string;
    public firstname: string;
    public id: string;

    constructor (id: string, surname: string, firstname: string ) {
        this.id = id;
        this.surname = surname;
        this.firstname = firstname;
    }
}
```

Zuletzt gibt es noch die Verknüpfungsklasse, die die Kooperation zwischen `Server` und `db-user` sicherstellt. Die Datenelemente der Datenerhaltungsklasse sind `public`. Hier gibt es klare Unterschiede zwischen Java und JavaScript.



